import "hash"
import "pe"

rule fractureiser_stage1 {
    meta:
        author = "cbax"
        author_email = "cbax+fractureiser@doslabelectronics.com"
        date = "2023-06-07"
        updated = "2023-06-07"
        description = "The fractureiser java malware stage one payload."
        threat_level = 4
        in_the_wild = true
        malware_type = "worm"
        malware_family = "Trojan.Java/Fractureiser"
        malware_author = "TheDxrkKiller"
        actor_type = "amateur"
        actor_group = "skyrage"
        
    strings:
        $ip0 = "85.217.144.130"
        $ip1 = "107.189.3.101"
        $ip2 = "171.22.30.117"
        $domain = "files-8ie.pages.dev"
        
    condition:
        any of them or
        hash.sha1(0, filesize) ==
        "dc43c4685c3f47808ac207d1667cc1eb915b2d82"
}

rule fractureiser_stage2 {
    meta:
        author = "cbax"
        author_email = "cbax+fractureiser@doslabelectronics.com"
        date = "2023-06-07"
        updated = "2023-06-07"
        description = "The fractureiser java malware stage two payload."
        threat_level = 4
        in_the_wild = true
        malware_type = "worm"
        malware_family = "Trojan.Java/Fractureiser"
        malware_author = "TheDxrkKiller"
        actor_type = "amateur"
        actor_group = "skyrage"
        
    strings:
        $ip0 = "85.217.144.130"
        $ip1 = "107.189.3.101"
        $ip2 = "171.22.30.117"
        $systemd_unit0 = "systemd-utility"
        $systemd_unit1 = "vmd-gnu"
        $ms_persist = "microsoft-vm-core"
        
    condition:
        any of them or
        hash.sha1(0, filesize) ==
        "52d08736543a240b0cbbbf2da03691ae525bb119" or
        hash.sha1(0, filesize) ==
        "6ec85c8112c25abe4a71998eb32480d266408863"
}

rule fractureiser_stage3 {
    meta:
        author = "cbax"
        author_email = "cbax+fractureiser@doslabelectronics.com"
        date = "2023-06-07"
        updated = "2023-06-07"
        description = "The fractureiser java malware stage three payload."
        threat_level = 4
        in_the_wild = true
        malware_type = "worm"
        malware_family = "Trojan.Java/Fractureiser"
        malware_author = "TheDxrkKiller"
        actor_type = "amateur"
        actor_group = "skyrage"
        
    strings:
        $ip0 = "85.217.144.130"
        $ip1 = "107.189.3.101"
        $ip2 = "171.22.30.117"
        $ip3 = "95.214.27.172"
        $domain = "skyrage.de"
        $msa_mime = "application/x-neko"
        $java_package = "dev.neko.nekoclient"
        $crypto_btc = "bc1q75kyl5s9l8kmtuhspkr7e8cen9r5dx78fxfe8h"
        $crypto_ltc = "LQzR1f6b3ztnSqxGZs1wtXnkwin4MeBfPc"
        $crypto_eth = "0x31683c675a3677E226496CC3F4E028c8577d30FA"
        $crypto_xrp = "rGGzBfSXy7C8Wcg3HE4ff7rchzTfoamZy3"
        $crypto_xmr = "49GsAVEgVt72YA59Ns5gvp2w6yq8GiV9dcHawwt6GEEjK3AxPaQie5TUvLyGULSixg44fiu8RnBcUQ6bENATixZYLXVbLq8"
        $crypto_bch = "qrp6alx43p0y59j7nd8cql24twk2hdk6hy4ecsv32h"
        $crypto_doge = "DSL7DgnebZ6D5qssKKWfG5VV2PeMd7qZQw"
        
    condition:
        any of them or
        hash.sha1(0, filesize) ==
        "c2d0c87a1fe99e3c44a52c48d8bcf65a67b3e9a5" or
        hash.sha256(0, filesize) ==
        "507cd3f6b701dbdbba86b1cb9bf3ac2e80b8176d60e116970c372caeb7e39eba" or
        hash.sha256(0, filesize) ==
        "2687b5e46d061e79952f10e96651fe9955d6b4aebad399a01b73d0b9fd31fd01" or
        hash.sha256(0, filesize) ==
        "611267eb6049f8450021da5dd4b38bebdbd04e9091be090ab10f152732d94bab" or
        pe.exports("Java_dev_neko_nekoclient_api_windows_WindowsHook_retrieveClipboardFiles") or
        pe.exports("Java_dev_neko_nekoclient_api_windows_WindowsHook_retrieveMSACredentials")
}
